<html lang="en">
<head>
    <script>
        const reloadPageFunction = async () => {
            const doWeReload = localStorage.getItem("Reload");
            if (doWeReload !== 'Nah') {
                await localStorage.setItem("Reload", "Nah");
                location.reload();
                return;
            }
        }

        const localStorageGenocide = () => {
            localStorage.removeItem("Reload")
        }

        reloadPageFunction();



        document.addEventListener('DOMContentLoaded', () => {
            const playButtons = document.querySelectorAll("[id^='Play_Button']");
            if (playButtons.length > 0) {
                playButtons.forEach(button => {
                    button.addEventListener("click", function(event) {
                        event.preventDefault(); // Prevent the default form submission
                        playAudio(button.closest("form")); // Pass the form to playAudio function
                    });
                });
            } else {
                console.error("Play buttons not found.");
            }
        });

        function playAudio(form) {
            const audio = new Audio("https://raw.githubusercontent.com/EyadYeager/MafiaBot-Real/main/arcade-retro-game-over-213%20-%20Copy.mp3");
            audio.play().then(() => {
                console.log("Audio playback started successfully.");
                setTimeout(() => {
                    form.submit(); // Submit the form after audio playback
                }, audio.duration * 1000); // Wait for the duration of the audio
            }).catch((error) => {
                console.error("Error occurred during audio playback:", error);
            });
        }

        const hideRole = async () => {
            const role = await document.getElementById("role-text");
            if (role.style.display === "none") {
                role.style.display = "block";
            } else {
                role.style.display = "none";
            }
        }
    </script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-image: url("https://i.ibb.co/QDMTJ3v/file-r5-VL7ke-Oz6n0csk-X8qhz-P4rk.png");
            background-repeat: no-repeat;
            background-size: cover;
            color: #333;
            text-align: center; /* Center align the content */
            font-size: 20px;

        }

        h1 {
            color: #775baf;
            font-family: Algerian;
        }

        a {
            display: inline-block;
            background-color: #775baf;
            color: ghostwhite;
            padding: 10px 20px;
            border-radius: 5px; /* Rounded corners for the links */
            text-decoration: none; /* Remove underline from links */
            transition: background-color 0.3s; /* Smooth transition for hover effect */

        }

        a:hover {
            background-color: #775baf; /* Darken the button upon hover */
        }

        .button {
            display: inline-block;
            background-color: #a156fc;
            color: ghostwhite;
            padding: 10px 20px;
            border-radius: 5px; /* Rounded corners for the links */
            text-decoration: none; /* Remove underline from links */
            transition: background-color 0.3s; /* Smooth transition for hover effect */

        }

        .username_box {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap; /* To wrap the player cards */
        }

        .username {
            font-size: 24px;
            color: ghostwhite;

        }

        .username-card-container {
            width: 14rem;
            height: 6rem;
            background-color: #775baf;
            border: 2px solid #000;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 2px 2px 2px 1px rgba(12, 0, 0, 0.4);
            margin: 5px; /* Adjust the margin as per your requirement */
        }

    </style>
    <title>Werewolf</title>
</head>
<body onunload="localStorageGenocide();">

<a href="/lobby/{{ lobbyid.lobbyId }}">Go back to lobby</a>

{#<form method="get" action="/lobby/{{ lobbyid.lobbyId }}/"> {% csrf_token %} <input type="hidden" name="return" > <input type="submit" value="Get back to lobby"> </form>#}


<div id="game-players">
    <div class="players-list">
    </div>
    <h1>It is day time</h1><br>
    {% if you.role == 0 and you.dead == False %}
        <h2 id="role-text">Citizen</h2>
    {% endif %}
    {% if you.role == 1 and you.dead == False %}
        <h2 id="role-text">Werewolf</h2>
    {% endif %}
    {% if you.role == 2 and you.dead == False %}
        <h2 id="role-text">Doctor</h2>
    {% endif %}
    {% if you.dead == True %}
        <h2 id="role-text">Dead</h2>
    {% endif %}
    {% if you.role == 4 %}
        <h2 id="role-text">Spectator</h2>
    {% endif %}

    <div class="player-info">
        <div class="username_box">

            {% for p in lobbyid.participants.all %}
                {% if p.dead == False %}
                    <div class="username-card-container">
                        {% if you.role == 1 and p.role == 1 %}
                            <p class="username" style="color: #770303">{{ p.userId.username }} </p>
                        {% else %}
                            <p class="username">{{ p.userId.username }} </p>
                        {% endif %}
                        <form method="get" action="/lobby/{{ lobbyid.lobbyId }}/gamestart/day/">
                            {% csrf_token %}
                            <input type="hidden" name="userid" value= {{ p.userId.id }}>
                            <input class="button" type="submit" id="Play_Button_{{ p.userId.id }}" value="Vote">
                        </form>
                    </div>
                    <br>
                {% endif %}
            {% endfor %}
        </div>
        {% if Dead_participant %}
            <ul>{{ Dead_participant.userId.username }} is dead</ul>
        {% endif %}
        <div id="hi">
            <br>
            <h3> People who haven't voted </h3>
        </div>

        <button onclick="hideRole()" class="button">Show/Hide role</button>

        <script>
            const JavascriptSucks = async () => {
                const lobby_id = "{{ lobbyid.lobbyId }}";
                const response = await fetch(`/lobby/` + lobby_id + `/gamestart/cyclecheck/`);
                const gamecycle = await response.text();
                if (gamecycle == 1) {
                    window.location.href = "/lobby/{{ lobbyid.lobbyId }}/gamestart/night/"
                }
                if ({{ werewolves }} >= {{townspeople}}) {
                    window.location.href = "/lobby/{{ lobbyid.lobbyId }}/gamestart/werewolves/"
                }
                if ({{werewolves}} < 1) {
                    window.location.href = "/lobby/{{ lobbyid.lobbyId }}/gamestart/townspeople/"
                }
            };

            setInterval(JavascriptSucks, 2000)

            setInterval(async () => {
                console.log('hi')

                const lobby_id = "{{ lobbyid.lobbyId }}";
                const response = await fetch(`/lobby/` + lobby_id + `/gamestart/daycheck/`);
                const didNotVote = await response.text();

                const hi = await document.getElementById('hi')
                console.log(hi)
                hi.innerHTML = `<br> <h3> People who haven't voted </h3> <p> ${didNotVote}</p>`
            }, 2000)
        </script>

        <div class="players-footer">
            <div class="dots" style="display: none;">
                <div class="dot active">
                    <div class="inner"></div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>
