<!DOCTYPE html>
<html lang="en">
<head>
    <title>Night</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-image: url("https://i.ibb.co/tQgLCRq/DALLE-2024-03-01-10-20-39-A-serene-nighttime-landscape-featuring-a-sky-filled-with-twinkling-stars-a.webp");
            background-repeat: no-repeat;
            background-size: cover;
            color: #333;
            text-align: center; /* Center align the content */
            padding-top: 50px; /* Add some space on the top */
        }

        h1 {
            color: #775baf;
            font-family: Algerian;
        }

        a {
            display: inline-block;
            background-color: #775baf;
            color: ghostwhite;
            padding: 10px 20px;
            margin: 10px 0; /* Add some margin to separate the links */
            border-radius: 5px; /* Rounded corners for the links */
            text-decoration: none; /* Remove underline from links */
            transition: background-color 0.3s; /* Smooth transition for hover effect */
        }

        a:hover {
            background-color: #775baf; /* Darken the button upon hover */
        }

        .button {
            display: inline-block;
            background-color: #775baf;
            color: ghostwhite;
            padding: 10px 20px;
            border-radius: 5px; /* Rounded corners for the links */
            text-decoration: none; /* Remove underline from links */
            transition: background-color 0.3s; /* Smooth transition for hover effect */
        }

        .username_box {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap; /* To wrap the player cards */
        }

        .username {
            font-size: 24px;
            color: ghostwhite;
        }

        .username-card-container {
            width: 14rem;
            height: 6rem;
            background-color: #775baf;
            border: 2px solid #000;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 2px 2px 2px 1px rgba(12, 0, 0, 0.4);
            margin: 5px; /* Adjust the margin as per your requirement */
        }

        .kill_button {
            color: red;
        }

        .rescue_button {
            color: #13b613;
        }

        .dead_list {
            background-color: rgba(119, 91, 175, 0.76);
            position: fixed;
            bottom: 0;
            right: 0;
            z-index: 998;
            padding: 40px;
            font-size: larger;
            color: ghostwhite;

        }
    </style>
</head>
<body>
<a href="/lobby/{{ lobbyid.lobbyId }}">Go back to lobby</a>

<h1>It is nighttime</h1><br>
{% if you.role == 0 and you.dead == False %}
    <h2>Citizen</h2>
{% endif %}
{% if you.role == 1 and you.dead == False %}
    <h2>Werewolf</h2>
{% endif %}
{% if you.role == 2 and you.dead == False %}
    <h2>Doctor</h2>
{% endif %}
{% if you.dead == True %}
    <h2 id="role-text">Dead</h2>
{% endif %}
{% if you.role == 4 %}
    <h2 id="role-text">Spectator</h2>
{% endif %}
<div class="username_box">
    {% for p in lobbyid.participants.all %}
        {% if p.dead == False %}
            <div class="username-card-container">
                {% if you.role == 1 and p.role == 1 %}
                    <p class="username" style="color: #780403">{{ p.userId.username }} </p>
                {% else %}
                    <p class="username">{{ p.userId.username }}
                {% endif %}
                {% if you.role == 1 and you.dead == False %}
                    <form method="get"
                          action="/lobby/{{ lobbyid.lobbyId }}/gamestart/night/">            {% csrf_token %}
                        <input type="hidden" name="userid" value= {{ p.userId.id }}>
                        <input class="kill_button" type="hidden" name="action" value="killed">
                        <input class="button" type="submit" value="KILL">
                    </form>
                {% elif you.role == 2 and you.dead == False %}
                    <form method="get"
                          action="/lobby/{{ lobbyid.lobbyId }}/gamestart/night/">            {% csrf_token %}
                        <input type="hidden" name="userid" value= {{ p.userId.id }}>
                        <input class="rescue_button" type="hidden" name="action" value="rescued">
                        <input class="button" type="submit" value="Rescue">
                    </form>
                {% endif %}
            </div>
        {% endif %}
    {% endfor %}
</div>
<br>
{% if Dead_participant %}
    <ul>{{ Dead_participant.userId.username }} is killed</ul>
{% endif %}


<div id="hi">
</div>


<div id="chat-box">
    <div id="messages"></div>
    <input type="text" id="chat-message" placeholder="Type a message...">
    <button onclick="sendMessage()">Send</button>
</div>

<script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
<script>
    const socket = io('http://146.190.21.110:5000');

    socket.on('message', function (message) {
        const messageElement = document.createElement('div');
        messageElement.textContent = message;
        document.getElementById('messages').appendChild(messageElement);
    });

    function sendMessage() {
        const messageInput = document.getElementById('chat-message');
        const message = messageInput.value;
        socket.emit('message', message);
        messageInput.value = '';
    }
</script>

<style>
    /* Add your styles for the chat box here */
    #chat-box {
        position: fixed;
        bottom: 0;
        right: 0;
        width: 300px;
        background-color: white;
        padding: 10px;
        border: 1px solid #ddd;
    }

    #messages {
        height: 200px;
        overflow-y: auto;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        padding: 5px;
    }
</style>

<div class="dead_list">
    <p>dead players are: <br></p>
    {% for participant in dead_participants %}
        <ul>{{ participant.userId.username }} </ul>
    {% endfor %}
</div>
<script>
    async function JavascriptSucks() {
        const lobby_id = "{{ lobbyid.lobbyId }}";
        const response = await fetch(`/lobby/` + lobby_id + `/gamestart/cyclecheck/`);
        const gamecycle = await response.text();
        if (gamecycle == 0) {
            window.location.href = "/lobby/{{ lobbyid.lobbyId }}/gamestart/day/"
        }
        if ({{ werewolves }} >= {{townspeople}}) {
            window.location.href = "/lobby/{{ lobbyid.lobbyId }}/gamestart/werewolves/"
        }
        if ({{werewolves}} < 1) {
            window.location.href = "/lobby/{{ lobbyid.lobbyId }}/gamestart/townspeople/"
        }
    }

    setInterval(JavascriptSucks, 2000)
</script>
</body>
</html>